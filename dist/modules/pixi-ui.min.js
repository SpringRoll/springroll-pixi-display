/*! SpringRoll Pixi Display 4.0.0 */
!function(){"use strict";!function(a){function b(a){if(!a||"object"!=typeof a)return null;var b=a.constructor();for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function c(a,b){if(a===b)return!0;for(var c in a)if(a[c]!=b[c])return!1;return!0}var d,e=include("PIXI.Container"),f=include("PIXI.Point"),g=include("PIXI.Sprite"),h=include("PIXI.extras.BitmapText",!1),i=include("PIXI.Text"),j=include("PIXI.Texture"),k=function(c,k,l){d=include("springroll.Debug",!1),e.call(this),this.back=new g,this.label=null,this._stateFlags={},this._statePriority=c.priority||n,this._stateData=null,this._currentLabelStyle=null,this._offset=new f,this._width=0,this._height=0,this.addChild(this.back),this._onOver=this._onOver.bind(this),this._onOut=this._onOut.bind(this),this._onDown=this._onDown.bind(this),this._onUp=this._onUp.bind(this),this._onUpOutside=this._onUpOutside.bind(this),this._emitPress=this._emitPress.bind(this);var m,o=this._stateData={};if(k){m=b(k),delete m.text,delete m.type,m.x===a&&(m.x="center"),m.y===a&&(m.y="center");var p=m.style=b(k.style);"bitmap"==k.type?p.align=p.align||"left":(p.font=p.font||"bold 20pt Arial",p.fill=p.fill||"black",p.align=p.align||"left",p.stroke=p.stroke||"black",p.strokeThickness=p.strokeThickness||0,p.wordWrap=p.wordWrap||!1,p.wordWrapWidth=p.wordWrapWidth||100)}for(var q=this._statePriority.length-1;q>=0;--q){var r=this._statePriority[q];this._addProperty(r),"disabled"!=r&&"up"!=r&&(this._stateFlags[r]=!1);var s=c[r];if(s?(s.tex?o[r]={tex:s.tex}:o[r]={tex:s},"string"==typeof o[r].tex&&(o[r].tex=j.fromImage(o[r].tex))):o[r]=o.up,k)if(s&&s.label){s=s.label;var t=o[r].label={};t.style=s.style||m.style,t.x=s.x||m.x,t.y=s.y||m.y}else o[r].label=m}if(o.up,o.over||(o.over=o.up),o.down||(o.down=o.up),o.disabled||(o.disabled=o.up),c.offset?(this._offset.x=c.offset.x,this._offset.y=c.offset.y):this._offset.x=this._offset.y=0,c.scale){var u=c.scale||1;this.back.scale.x=this.back.scale.y=u}k&&(this.label="bitmap"==k.type&&h?new h(k.text,m.style):new i(k.text,m.style),this.label.setPivotToAlign=!0,this.addChild(this.label)),this.back.x=this._offset.x,this.back.y=this._offset.y,this._width=this.back.width,this._height=this.back.height,this.enabled=l===a||!!l},l=extend(k,e);k.BUTTON_PRESS="buttonPress",k.BUTTON_OVER="buttonOver",k.BUTTON_OUT="buttonOut";var m=["disabled","enabled","up","over","down"],n=["disabled","down","over","up"];Object.defineProperty(l,"width",{get:function(){return this._width*this.scale.x},set:function(a){this.scale.x=a/this._width}}),Object.defineProperty(l,"height",{get:function(){return this._height*this.scale.y},set:function(a){this.scale.y=a/this._height}}),l.setText=function(a){if(this.label){this.label.text=a,this.label instanceof i?this.label.updateText():this.label.validate();for(var b,c=0;c<this._statePriority.length;++c)if(this._stateFlags[this._statePriority[c]]){b=this._stateData[this._statePriority[c]];break}if(b||(b=this._stateData.up),b=b.label,"center"==b.x){var d=this.back.width,e=this.label.width;switch(this._currentLabelStyle.align){case"center":this.label.position.x=.5*d;break;case"right":this.label.position.x=bw-.5*(d-e);break;default:this.label.position.x=.5*(d-e)}}else this.label.position.x=b.x+this._offset.x;"center"==b.y?this.label.position.y=.5*(this.back.height-this.label.height):this.label.position.y=b.y+this._offset.y}},Object.defineProperty(l,"enabled",{get:function(){return!this._stateFlags.disabled},set:function(a){this._stateFlags.disabled=!a,this.buttonMode=a,this.interactive=a,this.off("pointerdown",this._onDown),this.off("pointerover",this._onOver),this.off("pointerout",this._onOut),a?(this.on("pointerdown",this._onDown),this.on("pointerover",this._onOver),this.on("pointerout",this._onOut)):(this.off("pointerupoutside",this._onUpOutside),this.off("pointercancel",this._onUpOutside),this.off("pointerup",this._onUp),this._stateFlags.down=this._stateFlags.over=!1,this._over=!1,this._touchDown=!1),this._updateState()}}),l._addProperty=function(a){m.indexOf(a)>=0||Object.defineProperty(this,a,{get:function(){return this._stateFlags[a]},set:function(b){this._stateFlags[a]=b,this._updateState()}})},l._updateState=function(){if(this.back){for(var a,b=0;b<this._statePriority.length;++b)if(this._stateFlags[this._statePriority[b]]){a=this._stateData[this._statePriority[b]];break}if(a||(a=this._stateData.up),this.back.texture=a.tex,this.label){var d=a.label,e=this.label;if(this._currentLabelStyle&&c(this._currentLabelStyle,d.style)||(e.font=d.style.font,e.align=d.style.align,this._currentLabelStyle=d.style,e instanceof i?e.updateText():e.validate()),"center"==d.x){var f=this.back.width,g=e.width;switch(this._currentLabelStyle.align){case"center":e.position.x=.5*f;break;case"right":e.position.x=f-.5*(f-g);break;default:e.position.x=.5*(f-g)}}else e.position.x=d.x+this._offset.x;"center"==d.y?e.position.y=.5*(this.back.height-e.height):e.position.y=d.y+this._offset.y}return a}},l._onOver=function(a){this._stateFlags.over=!0,this._updateState(),this.emit(k.BUTTON_OVER,this)},l._onOut=function(a){this._stateFlags.over=!1,this._updateState(),this.emit(k.BUTTON_OUT,this)},l._onDown=function(a){this._stateFlags.down=!0,this._updateState(),this.on("pointerupoutside",this._onUpOutside),this.on("pointercancel",this._onUpOutside),this.on("pointerup",this._onUp)},l._onUp=function(a){this._stateFlags.down=!1,this.off("pointerupoutside",this._onUpOutside),this.off("pointercancel",this._onUpOutside),this.off("pointerup",this._onUp),this._updateState(),setTimeout(this._emitPress,0)},l._emitPress=function(){this.emit(k.BUTTON_PRESS,this)},l._onUpOutside=function(a){this._stateFlags.down=!1,this.off("pointerupoutside",this._onUpOutside),this.off("pointercancel",this._onUpOutside),this.off("pointerup",this._onUp),this._updateState()},l.destroy=function(){this.removeAllListeners(),this.removeChildren(),this.label=null,this.back=null,this._stateData=null,this._stateFlags=null,this._statePriority=null},namespace("springroll").Button=k,namespace("springroll.pixi").Button=k}(),function(){var a=function(a){this.obj=a,this.mouseDownObjPos={x:0,y:0},this.dragOffset=new PIXI.Point,this.mouseDownStagePos={x:0,y:0}};namespace("springroll").DragData=a,namespace("springroll.pixi").DragData=a}(),function(){var a,b,c,d=include("springroll.pixi.DragData"),e=function(d,e,f){a||(a=include("springroll.Application"),b=include("createjs.Tween",!1),c=include("PIXI.Point")),"function"!=typeof d||f||(f=e,e=d,d=a.instance.display),this.draggedObj=null,this.dragStartThreshold=20,this.mouseDownStagePos=new c(0,0),this.mouseDownObjPos=new c(0,0),this.allowStickyClick=!0,this.isTouchMove=!1,this.isHeldDrag=!1,this.isStickyClick=!1,this.snapSettings=null,this._interaction=d.renderer.plugins.interaction,this._dragOffset=null,this._dragStartCallback=e,this._dragEndCallback=f,this._triggerHeldDrag=this._triggerHeldDrag.bind(this),this._triggerStickyClick=this._triggerStickyClick.bind(this),this._stopDrag=this._stopDrag.bind(this),this._updateObjPosition=this._updateObjPosition.bind(this),this._draggableObjects=[],this._multitouch=!1,this._addedDragListeners=!1,this.helperPoint=new c(0,0)},f=extend(e);Object.defineProperty(f,"multitouch",{get:function(){return this._multitouch},set:function(a){if(this.draggedObj)if(this._multitouch)for(var b in this.draggedObj)this._stopDrag(b,!0);else this._stopDrag(null,!0);this._multitouch=!!a,this.draggedObj=a?{}:null}}),f.startDrag=function(a,b){this._objMouseDown(a,b)},f._objMouseDown=function(a,e){var f=e.data;if(!(!this._multitouch&&this.draggedObj||this._multitouch&&!f)){var g,h,i,j;this._multitouch?(g=new d(a),this.draggedObj[f.identifier]=g,h=g.mouseDownObjPos,i=g.mouseDownStagePos,j=g.dragOffset):(this.draggedObj=a,h=this.mouseDownObjPos,i=this.mouseDownStagePos,j=this._dragOffset=new c),b&&(b.removeTweens(a),b.removeTweens(a.position)),a._dragOffset?(j.x=a._dragOffset.x,j.y=a._dragOffset.y):(f.getLocalPosition(a.parent,j),j.x-=a.position.x,j.y-=a.position.y),h.x=a.position.x,h.y=a.position.y,f?(i.x=f.global.x,i.y=f.global.y,this.allowStickyClick&&"touch"!=f.pointerType?(this._interaction.on("pointermove",this._triggerHeldDrag),this._interaction.on("pointerup",this._triggerStickyClick)):(this.isTouchMove="touch"==f.pointerType,this.isHeldDrag=!0,this._startDrag(f))):(this.isHeldDrag=!0,this._startDrag())}},f._triggerStickyClick=function(a){var b=a.data;this.isStickyClick=!0;this._multitouch?this.draggedObj[b.identifier].obj:this.draggedObj;this._interaction.off("pointermove",this._triggerHeldDrag),this._interaction.off("pointerup",this._triggerStickyClick),this._startDrag(b)},f._triggerHeldDrag=function(a){var b,c=a.data;this._multitouch?(this.draggedObj[c.identifier].obj,b=this.draggedObj[c.identifier].mouseDownStagePos):(this.draggedObj,b=this.mouseDownStagePos);var d=c.global.x-b.x,e=c.global.y-b.y;d*d+e*e>=this.dragStartThreshold*this.dragStartThreshold&&(this.isHeldDrag=!0,this._interaction.off("pointermove",this._triggerHeldDrag),this._interaction.off("pointerup",this._triggerStickyClick),this._startDrag(c))},f._startDrag=function(a){var b;b=this._multitouch?this.draggedObj[a.identifier].obj:this.draggedObj,this._updateObjPosition({data:a}),this._addedDragListeners||(this._addedDragListeners=!0,this._interaction.on("pointermove",this._updateObjPosition),this._interaction.on("pointerup",this._stopDrag),this._interaction.on("pointerupoutside",this._stopDrag),this._interaction.on("pointerupcancel",this._stopDrag)),this._dragStartCallback(b)},f.stopDrag=function(a,b){var c=null;if(this._multitouch&&b)for(var d in this.draggedObj)if(this.draggedObj[d].obj==b){c=d;break}this._stopDrag(c,!0===a)},f._stopDrag=function(a,b){var c,d=null;if("number"==typeof a?d=a:a&&(d=a.data.identifier),this._multitouch){if(null===d){for(d in this.draggedObj)this._stopDrag(d,b);return}var e=this.draggedObj[d];if(!e)return;c=e.obj,this.mouseDownObjPos.x=e.mouseDownObjPos.x,this.mouseDownObjPos.y=e.mouseDownObjPos.y,delete this.draggedObj[d]}else c=this.draggedObj,this.draggedObj=null;if(c){var f=!this._multitouch;if(this._multitouch){var g=!1;for(d in this.draggedObj){g=!0;break}f=!g}f&&this._addedDragListeners&&(this._addedDragListeners=!1,this._interaction.off("pointermove",this._updateObjPosition),this._interaction.off("pointerup",this._stopDrag),this._interaction.off("pointerupoutside",this._stopDrag),this._interaction.off("pointerupcancel",this._stopDrag)),this.isTouchMove=!1,this.isStickyClick=!1,this.isHeldMove=!1,!1!==b&&this._dragEndCallback(c)}},f._updateObjPosition=function(a){var b,c,d=a.data;if(this._multitouch){var e=this.draggedObj[d.identifier];b=e.obj,c=e.dragOffset}else b=this.draggedObj,c=this._dragOffset;if(!b||!b.parent)return void this.stopDrag(!1,b);var f=d.getLocalPosition(b.parent,this.helperPoint),g=b._dragBounds;if(g?(b.position.x=Math.clamp(f.x-c.x,g.x,g.right),b.position.y=Math.clamp(f.y-c.y,g.y,g.bottom)):(b.position.x=f.x-c.x,b.position.y=f.y-c.y),this.snapSettings)switch(this.snapSettings.mode){case"points":this._handlePointSnap(f,c,b)}},f._handlePointSnap=function(a,b,c){for(var d=this.snapSettings,e=d.dist*d.dist,f=d.points,g=a.x-b.x,h=a.y-b.y,i=-1,j=null,k=f.length-1;k>=0;--k){var l=f[k],m=Math.distSq(g,h,l.x,l.y);m<=e&&(m<i||-1==i)&&(i=m,j=l)}j&&(draggedObj.position.x=j.x,draggedObj.position.y=j.y)};var g=function(){this.on("pointerdown",this._onMouseDownListener),this.buttonMode=this.interactive=!0},h=function(){this.off("pointerdown",this._onMouseDownListener),this.buttonMode=this.interactive=!1},i=function(a){this._dragMan._objMouseDown(this,a)};f.addObject=function(a,b,c){b&&(b.right=b.x+b.width,b.bottom=b.y+b.height),a._dragBounds=b,a._dragOffset=c||null,this._draggableObjects.indexOf(a)>=0||(a.enableDrag=g,a.disableDrag=h,a._onMouseDownListener=i.bind(a),a._dragMan=this,this._draggableObjects.push(a))},f.removeObject=function(a){var b=this._draggableObjects.indexOf(a);b>=0&&(a.disableDrag(),delete a.enableDrag,delete a.disableDrag,delete a._onMouseDownListener,delete a._dragMan,delete a._dragBounds,delete a._dragOffset,this._draggableObjects.splice(b,1))},f.destroy=function(){this.stopDrag(!1),this._updateObjPosition=null,this._dragStartCallback=null,this._dragEndCallback=null,this._triggerHeldDrag=null,this._triggerStickyClick=null,this._stopDrag=null,this._interaction=null;for(var a=this._draggableObjects.length-1;a>=0;--a){var b=this._draggableObjects[a];b.disableDrag(),delete b.enableDrag,delete b.disableDrag,delete b._onMouseDownListener,delete b._dragMan,delete b._dragBounds,delete b._dragOffset}this._draggableObjects=null},namespace("springroll").DragManager=e,namespace("springroll.pixi").DragManager=e}();}();